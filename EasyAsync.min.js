/* Copyright 2014 Kevin Moody. Released under the MIT license */
"use strict";var EasyAsync={};EasyAsync._reqs={};EasyAsync._jobs=[];EasyAsync.start=function(name,num){num||(num=1);if(this._isRegistered(name)){if(this._reqs[name].count==-1){this._reqs[name].count=num}else{throw"Task name already registered."}}else{this._reqs[name]={count:num,jobIds:[]}}return function(){this.finish(name)}.bind(this)};EasyAsync.finish=function(name){if(!this._isRegistered(name)){throw"Task name not registered."}this._reqs[name].count<=0||this._reqs[name].count--;this._runJobs(name)};EasyAsync.after=function(names,job){var jobId=this._jobs.length;this._jobs[jobId]={job:job,reqs:names};var numNames=names.length;for(var i=0;i<numNames;i++){var name=names[i];if(this._isRegistered(name)){this._reqs[name].jobIds.push(jobId);this._runJobs(name)}else{this._reqs[name]={count:-1,jobIds:[jobId]}}}};EasyAsync._isRegistered=function(name){return typeof this._reqs[name]!=="undefined"};EasyAsync._runJobs=function(name){var jobIds=this._reqs[name].jobIds,numJobs=jobIds.length,remainingJobIds=[];for(var i=0;i<numJobs;i++){if(!this._runJob(jobIds[i])){remainingJobIds.push(jobIds[i])}}this._reqs[name].jobIds=remainingJobIds};EasyAsync._runJob=function(jobId){var reqs=this._jobs[jobId].reqs,numReqs=reqs.length;for(var i=0;i<numReqs;i++){if(!this._isRegistered(reqs[i])||this._reqs[reqs[i]].count!=0){return false}}this._jobs[jobId].job();delete this._jobs[jobId];return true};if(typeof module!=="undefined"&&module.exports){module.exports=EasyAsync}